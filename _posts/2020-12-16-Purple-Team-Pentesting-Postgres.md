---
layout: post
title: "Purple Team PostgreSQL - Pentesting PostgreSQL Databases and Servers"
description: "Pentesting PostgreSQL Databases and Servers - Notes"
comments: true
keywords: "security, postgres, database, servers, red team, pentesting"
---

> This is a post holding my notes and other work in progress items and will be updated sporadically.  Last updated 16-12-2020.

The HINT in an [ERROR](http://www.postgresqltutorial.com/plpgsql-errors-messages/) message leaks information

The ERROR message [leaks information](http://www.postgresqltutorial.com/plpgsql-errors-messages/)

[DROP](http://www.postgresqltutorial.com/postgresql-indexes/postgresql-drop-index/) index statement

LIST index statement (which [part is reconnaissance](http://www.postgresqltutorial.com/postgresql-indexes/postgresql-list-indexes/) though)

Being able to find the Postgres version

Being able to query the type of index

Being able to [DELETE](http://www.postgresqltutorial.com/postgresql-delete/) or an attempt was made to DELETE

# Types of query actions to look for

A new role was CREATED

```
CREATE ROLE username NOINHERIT LOGIN PASSWORD password;
CREATE ROLE role_name;
```

Roles have been set
```
GRANT role_2 TO role_1;
```

Database has been deleted

```
DROP DATABASE [IF EXISTS] db_name;
```

A column has been dropped
```
ALTER TABLE table_name DROP COLUMN column_name;
```

A table has been dropped
```
DROP TABLE [IF EXISTS] table_name CASCADE;
```

# Other items

[How to prevent disaster recovery](https://www.postgresql.eu/events/pgconfeu2019/schedule/session/2754-you-forgot-to-put-the-where-in-the-delete/)

[No data at rest encryption](https://www.cybertec-postgresql.com/en/products/postgresql-transparent-data-encryption/)

Blocks are decrypted as they are read from disk (side channel attack) - [source](https://www.cybertec-postgresql.com/en/products/postgresql-transparent-data-encryption/)

Is the database first nitialized with encryption in mind and that the key used for initializing the database is accessible to the server during startup.

The following are not encrypted: Transport encryption (client / server) via SSL; Encrypted replication; Fully secured replicas - [source](https://www.cybertec-postgresql.com/en/products/postgresql-transparent-data-encryption/)

The Client connection to the database is not encrypted (ie SSL)

[Postgres SQL injections](http://pentestmonkey.net/cheat-sheet/sql-injection/postgres-sql-injection-cheat-sheet)

Being able to use WAL to shutdown PostgreSQL [filling up pg_xlog/ directory](https://www.postgresql.org/docs/9.3/continuous-archiving.html)

Can you enumerate the PostgreSQL details - [use nmap against metasploitable](https://pen-testing-lab.blogspot.com/2012/01/brute-forcing-postgres.html)

Can you brute force into PostgreSQL database - [use msfconsole and wordlists](https://pen-testing-lab.blogspot.com/2012/01/brute-forcing-postgres.html)

[Pentesters' Guide to Postgres](https://hakin9.org/a-penetration-testers-guide-to-postgresql/)

[Admin Postgres Auxiliary Modules](https://www.offensive-security.com/metasploit-unleashed/admin-postgres-auxiliary-modules/) on Metasploit including [setup](https://fedoraproject.org/wiki/Metasploit_Postgres_Setup)
